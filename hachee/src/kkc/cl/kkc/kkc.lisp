(defpackage :hachee.kkc
  (:use :cl :hachee.kkc.word)
  (:export :convert
           :convert-to-nodes

           :lookup
           :lookup-items

           :profile
           :make-kkc
           :create-kkc
           :create-kkc-unk-supported
           :save-kkc
           :load-kkc
           :word-form
           :word-pron

           :build-tankan-dictionary)
  (:import-from :alexandria
                :curry))
(in-package :hachee.kkc)

(defun sentence-words (sentence)
  (mapcar (lambda (form-pron-str)
            ;; A/a-/B/b => AB/ab
            (let ((form-pron-list
                   (mapcar (lambda (form-pron-part-str)
                             (let ((split (cl-ppcre:split
                                           "/"
                                           form-pron-part-str)))
                               (list (or (first split) "")
                                     (or (second split) ""))))
                           (cl-ppcre:split "-" form-pron-str))))
              (make-word
               :form (format nil "窿磲疸狎＇骈蝮骘蝽痱镱扉篝┅吼蝻ㄦ矧磲铋窿磲疸狎＇箦泔钿骘蝽痱镱扉篝┅┅ㄨ徙桢瀹腚惝骈戾后孱翦钽瀛躅轸箦铘孱沐┅ㄤ彐躅怩殪洵鲲汜怩灬蝙疳翳钺礤螬戾è鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤螬ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗鲲汜黠蜾┅┅鲲汜猢ㄤ彐躅怩殪洵鲲汜怩灬蝙鏖翳躅疳翳钺礤脲秭弪灬博戾è鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅黠蜾脲炬蝈磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è沲蝌黠蜾磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅箦翩ㄧ弭栳箬黠蜾倦妁黠蜾沲蝌黠蜾螬黠蜾┅磲痂狍灬礅溽黠蜾脲黠蜾戾è骝羼ㄩ钽ㄧ弭栳箬黠蜾脲黠蜾脲炬蝈癌┅麒孱冀秭弪灬骝羼ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗鲲汜黠蜾┅┅沲蝌黠蜾螬┅鲲汜猢ㄤ彐躅怩殪洵溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙戾è溟泗ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙喉犭瀛溟泗轱钺蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤溟泗ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋鲲汜怩灬蝙黠蜾ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙横滗溟泗黠蜾┅┅溟泗┅ㄤ彐躅怩殪洵瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙戾è麸轭舡矧躅ㄣ躜蝙＇栳汨邋腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧躅鲲汜怩灬蝙┅孪ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩孪荧┅ㄅ嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩畔荧┅盹溴磲脲轭篝犷沐ц徙桢瀹灬铉踽珏盹溴飚瞽珧犴喉镤屐┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è箦铘孱沐磲疸狎灬礅溽箦铘孱沐ㄨ徙桢瀹灬铉踽珏盹溴旌磲脲箦铘孱沐呼镫孱磲疸狎麸轭舡矧躅箦铘孱沐黠蜾箦铘孱沐┅┅ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅┅ㄨ徙桢瀹灬铉踽珏盹溴飚瞽珧犴呼蜥轭盹溴箦铘孱沐郝嫌孪号嫌畔萤┅盹溴飑ㄤ彐躅怩殪洵躅腩秣瞽黠蜾鲲汜怩灬蝙疳翳钺礤鲲汜怩灬蝙脲秭弪灬博戾è脲炬蝈磲脲栳箬翎忪呼弩＇羼踽飑ㄣ栳颦鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è沲蝌汨狎磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱铒ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙黠蜾┅祜镳骘汨狎徙蝻篌黠蜾痱镱黠蜾滹戾è汨狎黠蜾磲脲黠蜾烘矧篝蜷铉汨狎吼蝻篝蜷铉汨狎┅┅箦翩ㄧ弭栳箬黠蜾倦妁汨狎黠蜾沲蝌汨狎螬汨狎黠蜾┅┅┅磲痂狍灬礅溽脲汨狎黠蜾戾è骝羼ㄩ钽ㄧ弭栳箬脲脲炬蝈癌┅麒孱冀秭弪灬骝羼ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗汨狎鲲汜汨狎黠蜾┅┅沲蝌汨狎螬┅汨狎鲲汜猢ㄤ彐躅怩殪洵躅腩秣瞽黠蜾瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙戾è孪ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩孪荧┅ㄅ嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩畔荧┅盹溴磲脲轭篝犷沐ц徙桢瀹灬铉踽珏盹溴飚瞽珧犴喉镤屐┅ㄤ镬轶疳翳钺礤疳翳钺礤螬ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱铒ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋鲲汜怩灬蝙黠蜾┅戾è麸脲铙祜镳骘汨狎徙蝻篌黠蜾痱镱黠蜾泔祆邈ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧躅躅腩秣瞽黠蜾鲲汜怩灬蝙磲脲黠蜾烘矧篝蜷铉汨狎吼蝻篝蜷铉汨狎┅┅┅戾è箦铘孱沐扉篝ㄨ徙桢瀹灬铉踽珏盹溴旌磲脲箦铘孱沐呼镫孱麸脲铙┅┅ㄨ徙桢瀹灬铉踽珏盹溴飚瞽珧犴呼蜥轭盹溴箦铘孱沐郝嫌孪号嫌畔萤┅┅┅盹溴飑ㄤ彐躅怩殪洵翎铍犷溟泗轱钺蝙疳翳钺礤螬戾è溟泗ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙喉犭瀛溟泗轱钺蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤螬鏖翳镳孱骈戾ㄩ疳翳钺礤祜镳骘扉铄蝈徜扉铄轭铋铋飑麒殪扉铄滹ㄤ弩趄蹉趱蜷铉忾钿ㄦ矧疳螋痱镱ㄣ飙痧泸搴箴扉扉铄ㄤ邈灬蝈ㄩ珙矧疳螋┅戾è黠蜾ㄨ徙桢瀹腚惝黠蜾喉犭瀛黠蜾烘矧骘蝽吼蝻痱镱┅ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙横滗溟泗黠蜾┅┅┅溟泗┅ㄤ彐篝蝓泗腚瞽珧犴盹溴鲲汜怩灬蝙鲲汜怩灬蝙溟泗轱钺蝙屮翦钿邃溟泗轱钺蝙翎铍犷溟泗轱钺蝙ㄤ彐篝蝓泗躅氕篚痧矧翦洵腚ê轭沆蹁腚悌篚憝痱镡徕殪轸殄蟓镦鲲汜怩灬蝙黠蜾躅腩秣瞽黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾瞽珧犴盹溴飑ㄤ彐躅泸遽翦腚疳翳钺礤脲翎铍犷溟泗轱钺蝙戾舄è鲲汜怩灬蝙ㄢ蹰熹鲲汜怩灬蝙疳翳钺礤螬ㄤ殂糸镱狎ㄢ蹰熹溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙┅瞽珧犴盹溴ㄢ蹰熹瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙┅ㄨ徙桢瀹腚愫磲脲腚侯珧犴盹溴瞽珧犴盹溴忽镢徕蹯狎鲲汜怩灬蝙忽镢徕蹯狎溟泗轱钺蝙溟泗轱钺蝙哄翦钿邃溟泗轱钺蝙ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙喉犭瀛溟泗轱钺蝙呼犷脶瞽溟泗轱钺蝙翎铍犷溟泗轱钺蝙┅ㄤ彐躅黠蜾俱栳颦麸脲铙黠蜾躅腩秣瞽黠蜾鲲汜怩灬蝙戾è痱镱ㄨ徙桢瀹腚惝黠蜾瑚矧洵痱镱黠蜾┅祜镳骘汨狎徙蝻篌痱镱泔祆邈ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧躅躅腩秣瞽黠蜾鲲汜怩灬蝙ㄨ徙桢瀹腚惝黠蜾喉犭瀛黠蜾烘矧篝蜷铉汨狎吼蝻篝蜷铉汨狎┅┅┅ㄤ彐躅篚憝痱镡徕殪轸殄蟓镦黠蜾躅腩秣瞽黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾瞽珧犴盹溴黠蜾螬祜镳骘黠蜾轭黠蜾篚ㄥㄨ徙桢瀹灬铉踽珏盹溴飚瞽珧犴后孱翦钽瀛祜绛痱镡徕殪轸躅腩秣瞽黠蜾瞽珧犴盹溴ㄨ徙桢瀹灬铉踽珏盹溴旌磲脲箦铘孱沐呼镫孱黠蜾俱栳颦麸脲铙黠蜾躅腩秣瞽黠蜾鲲汜怩灬蝙┅郝嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩孪荧号嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩畔荧┅┅ㄤ彐躅泸遽翦腚悱躅氕篚痧矧翦疳翳钺礤脲翎铍犷溟泗轱钺蝙屮翦钿邃溟泗轱钺蝙ㄡ篌弪冀戾铉翳疳翳钺礤螬┅戾舄è鲲汜怩灬蝙ㄢ蹰熹鲲汜怩灬蝙鏖翳躅疳翳钺礤螬ㄤ殂糸镱狎ㄢ蹰熹溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙┅瞽珧犴盹溴ㄢ蹰熹瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙┅躅腩秣瞽黠蜾鲲汜怩灬蝙ㄢ蹰熹躅腩秣瞽黠蜾鲲汜怩灬蝙疳翳钺礤鲲汜怩灬蝙┅躅腩秣瞽黠蜾瞽珧犴盹溴ㄢ蹰熹躅腩秣瞽黠蜾瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙┅磲脲躅氕篚痧矧翦洵腚忽镢徕蹯狎鲲汜怩灬蝙侯珧犴盹溴瞽珧犴盹溴忽镢徕蹯狎溟泗轱钺蝙溟泗轱钺蝙哄翦钿邃溟泗轱钺蝙屮翦钿邃溟泗轱钺蝙呼犷脶瞽溟泗轱钺蝙翎铍犷溟泗轱钺蝙乎铍铒黝黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙乎铍铒黝黠蜾瞽珧犴盹溴躅腩秣瞽黠蜾瞽珧犴盹溴后蹴痱镡徕殪轸殄蟓镦鲲汜怩灬蝙黠蜾篚憝痱镡徕殪轸殄蟓镦黠蜾躅腩秣瞽黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾瞽珧犴盹溴ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙红轶舡犰飙黠蜾溟泗轱钺蝙┅┅ㄤ彐珏铄蜷珏舡筱矧瀛骖腚悌ㄤ彐礤翳镤珏舡筱矧瀛骖è腚腚悌ㄨ徙桢瀹腚惝泔铞弪舢筱矧瀛骖蠛镦骘蝽痱镱忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌┅ㄤ彐礤翳镤珏舡筱矧瀛骖è腚躅氕篚痧矧翦洵腚悌ㄨ徙桢瀹腚惝泔铞弪舢筱矧瀛骖蠛镦骘蝽痱镱躅氕篚痧矧翦忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌乎铍铒黝黠蜾鲲汜怩灬蝙躅氕篚痧矧翦洵腚悱躅腩秣瞽黠蜾鲲汜怩灬蝙腚悌乎铍铒黝黠蜾瞽珧犴盹溴躅氕篚痧矧翦洵腚悱躅腩秣瞽黠蜾瞽珧犴盹溴腚悌吼蝻忉忾扉豉骘颦屮翦钿邃溟泗轱钺蝙黠蜾戾è屮翦钿邃溟泗轱钺蝙箝ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙后辁腚悱屮翦钿邃溟泗轱钺蝙腚悌┅篚憝痱镡徕殪轸殄蟓镦鲲汜怩灬蝙黠蜾躅氕篚痧矧翦洵腚悱篚憝痱镡徕殪轸殄蟓镦鲲汜怩灬蝙黠蜾腚悌┅ㄩ屮翦钿邃溟泗轱钺蝙箝癌ǒ篚憝痱镡徕殪轸殄蟓镦鲲汜怩灬蝙黠蜾屮翦钿邃溟泗轱钺蝙箝濠┅┅ㄤ彐躅泔铞弪舡麸铒溴腚痱镱躅汩狒轱脲斌舡怙躅溽蝙轭溴ㄨ徙桢瀹腚惝泔铞弪艉屮邈豸痱镱躅汩狒轱后泔蝈骖ㄧ弭筱矧瀛骖腚悌忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌忽镢徕蹯狎溟泗轱钺蝙腚悱鲲汜怩灬蝙溟泗轱钺蝙腚悌哄翦钿邃溟泗轱钺蝙腚悱屮翦钿邃溟泗轱钺蝙腚悌罕篝怙躅溽蝙轭溴斌舡怙躅溽蝙轭溴┅ㄤ彐躅泔铞弪腚痱镱躅汩狒轱脲斌舡怙躅溽蝙轭溴磲疸狎＇铒溴黠蜾ㄣ镱鲥螋麸铒溴腚痱镱躅汩狒轱罕篝怙躅溽蝙轭溴斌舡怙躅溽蝙轭溴┅ㄤ彐躅祜镫躔轸屙腚痱镱躅汩狒轱瞟ㄨ徙桢瀹腚惝祜镫躔哄邈豸痱镱躅汩狒轱忽镢徕蹯狎溟泗轱钺蝙腚悱鲲汜怩灬蝙溟泗轱钺蝙腚悌呼犷脶瞽溟泗轱钺蝙腚悱翎铍犷溟泗轱钺蝙腚悌┅ㄤ彐躅祜镫躔腚痱镱躅汩狒轱瞟磲疸狎＇栳汨邋腚惝祜镫躔洪翦憝黠蜾祜镫躔轸屙腚痱镱躅汩狒轱瞟┅ㄤ彐躅筢鲥腚腚疳翳钺礤ㄨ徙桢瀹腚惝狎汨轹搴筢鲥疳翳钺礤忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌轰殂糸镱狎腚悱鲲汜怩灬蝙溟泗轱钺蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌┅ㄤ彐躅祜徜腚疳翳钺礤ㄤ弩趄蹉趱蜷铉忾钿é脲鲲汜怩灬蝙溟泗轱钺蝙瞽珧犴盹溴飑ㄨ徙桢瀹腚惝狎汨轹搴祜徜疳翳钺礤磲脲腚忽镢徕蹯狎鲲汜怩灬蝙忽镢徕蹯狎溟泗轱钺蝙溟泗轱钺蝙侯珧犴盹溴瞽珧犴盹溴飑┅
(defpackage :hachee.kkc
  (:use :cl :hachee.kkc.word)
  (:export :convert
           :lookup
           :profile
           :make-kkc
           :create-kkc
           :create-kkc-unk-supported
           :save-kkc
           :load-kkc
           :word-form
           :word-pron)
  (:import-from :alexandria
                :curry))
(in-package :hachee.kkc)

(defun sentence-words (sentence)
  (mapcar (lambda (form-pron-str)
            ;; A/a-/B/b => AB/ab
            (let ((form-pron-list
                   (mapcar (lambda (form-pron-part-str)
                             (let ((split (cl-ppcre:split
                                           "/"
                                           form-pron-part-str)))
                               (list (or (first split) "")
                                     (or (second split) ""))))
                           (cl-ppcre:split "-" form-pron-str))))
              (make-word
               :form (format nil "窿磲疸狎＇骈蝮骘蝽痱镱扉篝┅吼蝻ㄦ矧磲铋窿磲疸狎＇箦泔钿骘蝽痱镱扉篝┅┅ㄨ徙桢瀹腚惝骈戾后孱翦钽瀛躅轸箦铘孱沐┅ㄤ彐躅怩殪洵鲲汜怩灬蝙疳翳钺礤螬戾è鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤螬ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗鲲汜黠蜾┅┅鲲汜猢ㄤ彐躅怩殪洵鲲汜怩灬蝙鏖翳躅疳翳钺礤脲秭弪灬博戾è鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅黠蜾脲炬蝈磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è沲蝌黠蜾磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅箦翩ㄧ弭栳箬黠蜾倦妁黠蜾沲蝌黠蜾螬黠蜾┅磲痂狍灬礅溽黠蜾脲黠蜾戾è骝羼ㄩ钽ㄧ弭栳箬黠蜾脲黠蜾脲炬蝈癌┅麒孱冀秭弪灬骝羼ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗鲲汜黠蜾┅┅沲蝌黠蜾螬┅鲲汜猢ㄤ彐躅怩殪洵溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙戾è溟泗ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙喉犭瀛溟泗轱钺蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤溟泗ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋鲲汜怩灬蝙黠蜾ㄨ徙桢瀹腚惝黠蜾溟泗轱钺蝙横滗溟泗黠蜾┅┅溟泗┅ㄤ彐躅怩殪洵瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙戾è麸轭舡矧躅ㄣ躜蝙＇栳汨邋腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧躅鲲汜怩灬蝙┅孪ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩孪荧┅ㄅ嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩畔荧┅盹溴磲脲轭篝犷沐ц徙桢瀹灬铉踽珏盹溴飚瞽珧犴喉镤屐┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è箦铘孱沐磲疸狎灬礅溽箦铘孱沐ㄨ徙桢瀹灬铉踽珏盹溴旌磲脲箦铘孱沐呼镫孱磲疸狎麸轭舡矧躅箦铘孱沐黠蜾箦铘孱沐┅┅ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅┅ㄨ徙桢瀹灬铉踽珏盹溴飚瞽珧犴呼蜥轭盹溴箦铘孱沐郝嫌孪号嫌畔萤┅盹溴飑ㄤ彐躅怩殪洵躅腩秣瞽黠蜾鲲汜怩灬蝙疳翳钺礤鲲汜怩灬蝙脲秭弪灬博戾è脲炬蝈磲脲栳箬翎忪呼弩＇羼踽飑ㄣ栳颦鲲汜ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙喉犭瀛鲲汜怩灬蝙┅ㄤ镬轶疳翳钺礤疳翳钺礤螬戾è沲蝌汨狎磲脲栳箬翎忪呼弩＇羼踽飑┅ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱铒ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭鲲汜怩灬蝙黠蜾┅祜镳骘汨狎徙蝻篌黠蜾痱镱黠蜾滹戾è汨狎黠蜾磲脲黠蜾烘矧篝蜷铉汨狎吼蝻篝蜷铉汨狎┅┅箦翩ㄧ弭栳箬黠蜾倦妁汨狎黠蜾沲蝌汨狎螬汨狎黠蜾┅┅┅磲痂狍灬礅溽脲汨狎黠蜾戾è骝羼ㄩ钽ㄧ弭栳箬脲脲炬蝈癌┅麒孱冀秭弪灬骝羼ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙横滗汨狎鲲汜汨狎黠蜾┅┅沲蝌汨狎螬┅汨狎鲲汜猢ㄤ彐躅怩殪洵躅腩秣瞽黠蜾瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙戾è孪ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩孪荧┅ㄅ嫌ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋躅腩秣瞽黠蜾鲲汜怩灬蝙栳汨邋腚惝黠蜾鲲汜怩灬蝙韩畔荧┅盹溴磲脲轭篝犷沐ц徙桢瀹灬铉踽珏盹溴飚瞽珧犴喉镤屐┅ㄤ镬轶疳翳钺礤疳翳钺礤螬ㄤ镬轶箦铘孱沐ㄨ徙桢瀹腚惝骈戾烘殪瀛倔趄轭绛箦铘孱沐疳翳钺礤┅ㄤ镬轶黠蜾箦铘孱沐黠蜾箦铘孱沐┅麒孱铒ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧铋鲲汜怩灬蝙黠蜾┅戾è麸脲铙祜镳骘汨狎徙蝻篌黠蜾痱镱黠蜾泔祆邈ㄨ徙桢瀹腚惝黠蜾鲲汜怩灬蝙呼锃轭舡矧躅躅腩秣瞽黠蜾鲲汜怩灬蝙磲脲黠蜾烘矧篝蜷铉汨狎吼蝻篝蜷铉汨狎┅┅┅戾è箦铘孱沐扉篝ㄨ徙桢瀹灬铉踽珏盹溴旌磲脲箦铘孱沐呼镫孱麸脲铙┅┅ㄨ徙桢瀹灬铉踽珏盹溴飚瞽珧犴呼蜥轭盹溴箦铘孱沐郝嫌孪号嫌畔萤┅┅┅盹溴飑ㄤ彐篝蝓泗腚鲲汜怩灬蝙瞽珧犴盹溴溟泗轱钺蝙ㄤ彐篝蝓泗躅氕篚痧矧翦洵腚ê轭沆蹁腚悌躅腩秣瞽黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾瞽珧犴盹溴飑ㄤ彐躅泸遽翦腚疳翳钺礤螬戾舄è鲲汜怩灬蝙ㄢ蹰熹鲲汜怩灬蝙疳翳钺礤螬ㄤ殂糸镱狎ㄢ蹰熹溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙┅瞽珧犴盹溴ㄢ蹰熹瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙┅ㄨ徙桢瀹腚愫磲脲腚忽镢徕蹯狎鲲汜怩灬蝙侯珧犴盹溴瞽珧犴盹溴轰殂糸镱狎溟泗轱钺蝙┅ㄤ彐躅泸遽翦腚悱躅氕篚痧矧翦疳翳钺礤螬ㄡ篌弪冀戾铉翳疳翳钺礤螬┅戾舄è鲲汜怩灬蝙ㄢ蹰熹鲲汜怩灬蝙鏖翳躅疳翳钺礤螬ㄤ殂糸镱狎ㄢ蹰熹溟泗轱钺蝙疳翳钺礤鲲汜怩灬蝙┅瞽珧犴盹溴ㄢ蹰熹瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙┅躅腩秣瞽黠蜾鲲汜怩灬蝙ㄢ蹰熹躅腩秣瞽黠蜾鲲汜怩灬蝙疳翳钺礤鲲汜怩灬蝙┅躅腩秣瞽黠蜾瞽珧犴盹溴ㄢ蹰熹躅腩秣瞽黠蜾瞽珧犴盹溴疳翳钺礤鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙┅磲脲躅氕篚痧矧翦洵腚忽镢徕蹯狎鲲汜怩灬蝙侯珧犴盹溴瞽珧犴盹溴轰殂糸镱狎溟泗轱钺蝙乎铍铒黝黠蜾鲲汜怩灬蝙躅腩秣瞽黠蜾鲲汜怩灬蝙乎铍铒黝黠蜾瞽珧犴盹溴躅腩秣瞽黠蜾瞽珧犴盹溴飑┅ㄤ彐珏铄蜷珏舡筱矧瀛骖腚悌ㄤ彐礤翳镤珏舡筱矧瀛骖è腚腚悌ㄨ徙桢瀹腚惝泔铞弪舢筱矧瀛骖蠛镦骘蝽痱镱忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌┅ㄤ彐礤翳镤珏舡筱矧瀛骖è腚躅氕篚痧矧翦洵腚悌ㄨ徙桢瀹腚惝泔铞弪舢筱矧瀛骖蠛镦骘蝽痱镱躅氕篚痧矧翦忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌乎铍铒黝黠蜾鲲汜怩灬蝙躅氕篚痧矧翦洵腚悱躅腩秣瞽黠蜾鲲汜怩灬蝙腚悌乎铍铒黝黠蜾瞽珧犴盹溴躅氕篚痧矧翦洵腚悱躅腩秣瞽黠蜾瞽珧犴盹溴腚悌┅ㄤ彐躅泔铞弪腚痱镱躅汩狒轱脲斌舡怙躅溽蝙轭溴戾è铒溴ㄨ徙桢瀹腚惝泔铞弪艉屮邈豸痱镱躅汩狒轱后泔蝈骖ㄧ弭筱矧瀛骖腚悌忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌轰殂糸镱狎腚悱溟泗轱钺蝙腚悌罕篝怙躅溽蝙轭溴斌舡怙躅溽蝙轭溴┅磲疸狎灬礅溽瞟扉篝ㄨ徙桢瀹腚惝泔铞弪艉铒溴黠蜾瞟ㄨ徙桢瀹腚惝泔铞弪艉铒溴矧殓轭瞟┅铒溴螬┅ㄤ彐躅祜镫躔腚痱镱躅汩狒轱瞟ㄨ徙桢瀹腚惝祜镫躔哄邈豸痱镱躅汩狒轱轰殂糸镱狎腚悱溟泗轱钺蝙腚悌┅ㄤ彐躅筢鲥腚腚疳翳钺礤ㄨ徙桢瀹腚惝狎汨轹搴筢鲥疳翳钺礤忽镢徕蹯狎腚悱鲲汜怩灬蝙腚悌轰殂糸镱狎腚悱溟泗轱钺蝙腚悌侯珧犴盹溴腚悱瞽珧犴盹溴腚悌┅ㄤ彐躅祜徜腚疳翳钺礤ㄤ弩趄蹉趱蜷铉忾钿é脲鲲汜怩灬蝙溟泗轱钺蝙瞽珧犴盹溴飑ㄨ徙桢瀹腚惝狎汨轹搴祜徜疳翳钺礤磲脲腚忽镢徕蹯狎鲲汜怩灬蝙轰殂糸镱狎溟泗轱钺蝙侯珧犴盹溴瞽珧犴盹溴飑┅